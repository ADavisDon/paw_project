<script>
  $(document).ready(function() {
    $('#dialog_addmember').dialog({
      autoOpen: false,
      modal: true,
      buttons: [
        {
          text: "Add non-registered Participant",
          click: function() {
            if ($("form#member_submit")[0].checkValidity()) {
              $("form#member_submit").submit();
              alert($("form#member_submit > div > input")[0].value + " has been added.");
              $(this).dialog("close");
            } else {
              alert("Please ensure both badge and name are provided.");
            }
          }
        }
      ]
    });

    $('.column_badge').change(function () {
      console.log($(this).val());
      //Modal box

      $.ajax ({
        url: "check_entry/" + $(this)[0].value,
        dataType: 'JSON',
        error: function(data) {
          console.log(data);
          /* Manual redirect to Participants view
          var check_badge = confirm("Badge " + data.responseJSON.badge_info + " must be added before proceeding");
          if (check_badge == true) {
            window.location.href = "/participants";
          }*/

          $('#dialog_addmember').dialog( "open" );
        }
      })
    });
  });
</script>

<%= form_with(url: game_logs_path) do |f| %>
  <%= f.label :inventory_id, "Game Title" %>
  <%= f.collection_select :inventory_id, Inventory.all, :id, :game_selection, prompt: true, required: true %>
  <%= f.label :timestamp %>
  <%= f.datetime_select :timestamp, ampm: true, default: Time.now %>
  <%= f.hidden_field :event_id, value: (@event_info[0]["id"]) %>

  <table>
    <tr>
      <th></th>
      <th>Badge ID</th>
      <th>Rating</th>
    </tr>
    <% 12.times do |e| %>
      <tr>
        <td><%= "Entry #{e + 1}" %></td>
        <td><%= f.number_field :badge_id, name: "badge_#{e}", class: "column_badge" %></td>
        <td>
        <% 5.times do |r| %>
            <%= "#{r + 1}" %>
            <%= f.radio_button "rating_#{e}", (r + 1) %>
        <% end %>
        </td>
      </tr>
    <% end %>
  </table>
  <%= f.submit %>
<% end %>

<div id="dialog_addmember" title="Add non-registered Participant">
  <%= render "shared/addmember" %>
  <!--
  <button form="member_submit" type="submit" id="main_submit" class="member_info">Add registered Participant</button>
  -->
</div>