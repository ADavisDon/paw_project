<script>
$('document').ready(function() {
  //Group logs by title
  for (i = 0; i < ($('.title').length);i++) {
    var firstCell = $('.title')[i].innerHTML;
    //debugger

    if (i != 0) {
      if (firstCell == ($('.title')[i - 1].innerHTML)) {
        $('.title')[i].remove();
        document.getElementsByClassName("title")[i - 1].rowSpan += 1;
        i -= 1;
      }
    } else {
      if (firstCell == ($('.title')[i + 1].innerHTML)) {
        $('.title')[i + 1].remove();
        document.getElementsByClassName("title")[i].rowSpan += 1;
      }
    }
  }
  //Group logs by time
  for (i = 0; i < ($('.timestamp').length);i++) {
    var firstCell = $('.timestamp')[i].innerHTML;
    //debugger

    if (i != 0) {
      if (firstCell == ($('.timestamp')[i - 1].innerHTML)) {
        $('.timestamp')[i].remove();
        document.getElementsByClassName("timestamp")[i - 1].rowSpan += 1;
        i -= 1;
      }
    } else {
      if (firstCell == ($('.timestamp')[i + 1].innerHTML)) {
        $('.timestamp')[i + 1].remove();
        document.getElementsByClassName("timestamp")[i].rowSpan += 1;
      }
    }
  }

  $('#dialog_editlog').dialog({
    autoOpen: false,
    modal: true,
  });
});

  function functionTest(obj) {
    $('#dialog_editlog').dialog('open');
    $.ajax({
      url: '/game_logs/' + $(obj).data().id + "/edit",
      success: function(e) {
        $('#dialog_editlog').html(e)
      }
    })
  }
</script>

<%= render 'shared/header' %>
<br><br>
<table>
  <tr>
    <th>Title</th>
    <th>Timestamp</th>
    <th>Participant</th>
    <th>Rating</th>
    <% if session[:user_name] == "admin" %>
      <th>Admin Controls</th>
    <% end %>
  </tr>
  <% @log_info.each do |v| %>
    <tr>
      <td class="title"><%= v[:title] %></td>
      <td class="timestamp"><%= v[:timestamp] %></td>
      <td><%= v[:member] %></td>
      <td><%= v[:rating] %></td>
      <% if session[:user_name] == "admin" %>
        <td>
          <%= link_to "Edit", "javascript:void(0)", data: {id: v[:id]}, onclick: "functionTest(this)" %>
          <%= link_to "Delete", v, method: :delete,
                                   data: { confirm: "Are you sure?" } %>
        </td>
    <% end %>
    </tr>
  <% end %>
</table>
<br><br>

<%= button_to "Add Game Log", game_logs_path, method: :get %>

<div id="dialog_editlog">
Failed to load Edit Page
</div>
